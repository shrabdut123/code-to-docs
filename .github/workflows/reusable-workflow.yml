name: Reusable Workflow
on:
  workflow_call:
    inputs:
      src-folder:
        description: 'Source folder of the calling repository'
        required: true
        type: string
      repo-name:
        description: 'Name of the calling repository'
        required: true
        type: string
      branch-name:
        description: 'Branch of the calling repository'
        required: true
        type: string
  workflow_dispatch:
    inputs:
      src-folder:
        description: 'Source folder of the calling repository'
        required: true
        type: string
      repo-name:
        description: 'Name of the calling repository'
        required: true
        type: string
      branch-name:
        description: 'Branch of the calling repository'
        required: true
        type: string
permissions:
  contents: "read"
  id-token: "write"
  actions:  "read"
jobs:
  run-script:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Caller Repository
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repo-name }}
          ref: ${{ inputs.branch-name }}
          token: ${{ secrets.PAT_TOKEN }}
          path: repo-caller
      - name: Checkout Repository B (where script is located)
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}  # Use PAT for private access
          path: repo-callee  # Path to checkout repo B in workspace

      - name: Print Source Folder Path
        run: echo "Source Folder Path ${{ inputs.src-folder }}"

      - name: Debug Repository Structure
        run: ls -R ${{ github.workspace }}
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: |
          pip install -r repo-callee/requirements.txt
      - name: Run Python script
        env:
          AZURE_OPENAI_API_KEY: ${{ secrets.AZURE_OPENAI_API_KEY }}  # Pass the secret to the script
          SRC_FOLDER: repo-caller/${{ inputs.src-folder}}
        run: |
          python repo-callee/generate_doc.py
